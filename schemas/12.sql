#Oppdaterer tabell for "kaffepriser"
#Fix problem with changed name of kaffepriser
CREATE OR REPLACE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `kaffeflytting_regnskap_lagertype_start` AS (select `rekneskap`.`regnskap`.`id` AS `regnskap_id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,-(sum(`rekneskap`.`kaffeflytting`.`antall`)) AS `antall`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from (((`regnskap` join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`start`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`) and (`rekneskap`.`kaffeflytting`.`fralagertype` = `rekneskap`.`lagertyper`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`) union (select `rekneskap`.`regnskap`.`id` AS `id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,sum(`rekneskap`.`kaffeflytting`.`antall`) AS `antall`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from (((`regnskap` join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`tillagertype` = `rekneskap`.`lagertyper`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`start`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`);
CREATE OR REPLACE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `kaffeflytting_regnskap_lagertype_slutt` AS (select `rekneskap`.`regnskap`.`id` AS `regnskap_id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,-(sum(`rekneskap`.`kaffeflytting`.`antall`)) AS `antall`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from (((`regnskap` join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`slutt`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`) and (`rekneskap`.`kaffeflytting`.`fralagertype` = `rekneskap`.`lagertyper`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`) union (select `rekneskap`.`regnskap`.`id` AS `id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,sum(`rekneskap`.`kaffeflytting`.`antall`) AS `antall`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from (((`regnskap` join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`tillagertype` = `rekneskap`.`lagertyper`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`slutt`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`);
CREATE OR REPLACE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `kaffeflytting_regnskap_kaffelager_lagertype_start` AS (select `rekneskap`.`regnskap`.`id` AS `regnskap_id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,-(sum(`rekneskap`.`kaffeflytting`.`antall`)) AS `antall`,`rekneskap`.`kaffelagre`.`nummer` AS `kaffelager_id`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from ((((`regnskap` join `kaffelagre`) join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`fra` = `rekneskap`.`kaffelagre`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`start`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`) and (`rekneskap`.`kaffeflytting`.`fralagertype` = `rekneskap`.`lagertyper`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffelagre`.`nummer`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`) union (select `rekneskap`.`regnskap`.`id` AS `id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,sum(`rekneskap`.`kaffeflytting`.`antall`) AS `antall`,`rekneskap`.`kaffelagre`.`nummer` AS `kaffelager_id`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from ((((`regnskap` join `kaffelagre`) join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`til` = `rekneskap`.`kaffelagre`.`nummer`) and (`rekneskap`.`kaffeflytting`.`tillagertype` = `rekneskap`.`lagertyper`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`start`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffelagre`.`nummer`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`) ;
CREATE OR REPLACE SQL SECURITY DEFINER VIEW `kaffeflytting_regnskap_kaffelager_lagertype_slutt` AS (select `rekneskap`.`regnskap`.`id` AS `regnskap_id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,-(sum(`rekneskap`.`kaffeflytting`.`antall`)) AS `antall`,`rekneskap`.`kaffelagre`.`nummer` AS `kaffelager_id`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from ((((`regnskap` join `kaffelagre`) join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`fra` = `rekneskap`.`kaffelagre`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`slutt`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`) and (`rekneskap`.`kaffeflytting`.`fralagertype` = `rekneskap`.`lagertyper`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffelagre`.`nummer`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`) union (select `rekneskap`.`regnskap`.`id` AS `id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,sum(`rekneskap`.`kaffeflytting`.`antall`) AS `antall`,`rekneskap`.`kaffelagre`.`nummer` AS `kaffelager_id`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from ((((`regnskap` join `kaffelagre`) join `kaffepriser`) join `lagertyper`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`til` = `rekneskap`.`kaffelagre`.`nummer`) and (`rekneskap`.`kaffeflytting`.`tillagertype` = `rekneskap`.`lagertyper`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`slutt`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`kaffelagre`.`nummer`,`rekneskap`.`kaffepriser`.`nummer`,`rekneskap`.`lagertyper`.`nummer`) ;
CREATE OR REPLACE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `kaffeflytting_regnskap_lagertype_innut` AS (select `rekneskap`.`regnskap`.`id` AS `regnskap_id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,-(sum(`rekneskap`.`kaffeflytting`.`antall`)) AS `antall`,`rekneskap`.`lagertyper`.`nummer` AS `lagertype_id` from (((`regnskap` join `lagertyper`) join `kaffepriser`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`fralagertype` = `rekneskap`.`lagertyper`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` > `rekneskap`.`regnskap`.`start`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`slutt`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`lagertyper`.`nummer`,`rekneskap`.`kaffepriser`.`nummer`) union (select `rekneskap`.`regnskap`.`id` AS `id`,`rekneskap`.`kaffepriser`.`nummer` AS `kaffepris_id`,sum(`rekneskap`.`kaffeflytting`.`antall`) AS `antall`,`rekneskap`.`lagertyper`.`nummer` AS `nummer` from (((`regnskap` join `lagertyper`) join `kaffepriser`) left join `kaffeflytting` on(((`rekneskap`.`kaffeflytting`.`tillagertype` = `rekneskap`.`lagertyper`.`nummer`) and (`rekneskap`.`kaffeflytting`.`dato` > `rekneskap`.`regnskap`.`start`) and (`rekneskap`.`kaffeflytting`.`dato` < `rekneskap`.`regnskap`.`slutt`) and (`rekneskap`.`kaffeflytting`.`type` = `rekneskap`.`kaffepriser`.`nummer`)))) group by `rekneskap`.`regnskap`.`id`,`rekneskap`.`lagertyper`.`nummer`,`rekneskap`.`kaffepriser`.`nummer`);
REPLACE INTO versions VALUES (12, 'db_schema');